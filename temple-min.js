function Expression(a){this._op=Temple.Operator.get(a.op),this._encode=Temple.Encoder[this._op.allow],this._params=a.params}var Temple={};Temple.VERSION="0.1.0",Temple.Operator={get:function(a){return this[a]||this["default"]},"default":{first:"",sep:",",named:!1,ifemp:"",allow:"U"},"+":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R"},".":{first:".",sep:".",named:!1,ifemp:"",allow:"U"},"/":{first:"/",sep:"/",named:!1,ifemp:"",allow:"U"},";":{first:";",sep:";",named:!0,ifemp:"",allow:"U"},"?":{first:"?",sep:"&",named:!0,ifemp:"=",allow:"U"},"&":{first:"&",sep:"&",named:!0,ifemp:"=",allow:"U"},"#":{first:"#",sep:",",named:!1,ifemp:"",allow:"U+R"}},function(){function c(a){return encodeURIComponent(a).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%27").replace(/\)/g,"%28").replace(/\*/,"%2A")}function d(a,b,d){var e=""+a,f;if(d&&/\%/.test(e))try{e=decodeURIComponent(e)}catch(g){}return function h(a){return(f=b.exec(e))?e.slice(a,f.index)+c(f[0])+h(f.index+1):e.substring(a)}(0)}var a=Array.prototype,b={U:/[^\w~.\-]/g,UR:/[^\w.~:\/\?#\[\]@!\$&'()*+,;=\-]/g,L:/[\x01-\x1A]|[ "'<>\\\^`{|}]|%(?![a-fA-F0-9]{2})/g};Temple.Encoder={varname:encodeURIComponent,literal:function(a){return d(a,b.L)},unreserved:function(a){return d(a,b.U,!0)},reserved:function(a){return d(a,b.UR,!0)}},Temple.Encoder.L=Temple.Encoder.literal,Temple.Encoder.U=Temple.Encoder.unreserved,Temple.Encoder["U+R"]=Temple.Encoder.reserved,Temple.Array={each:a.forEach?function(a,b,c){a.forEach(b,c)}:function(a,b,c){var d,e;for(d=0,e=a&&a.length||0;d<e;++d)a[d]!==undefined&&b.call(c,a[d],d,a)},filter:a.filter?function(a,b,c){return a.filter(b,c)}:function(a,b,c){var d=[];return Temple.Array.each(a,function(e,f){b.call(c,e,f,a)&&d.push(e)}),d},isArray:Array.isArray?Array.isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},map:a.map?function(a,b,c){return a.map(b,c)}:function(a,b,c){var d=a.concat();return Temple.Array.each(a,function(e,f){d=b.call(c,e,f,a)},c),d}},Temple.Object={each:function(a,b,c){var d;for(d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)},some:function(a,b,c){var d;for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d,a))return!0;return!1}}}();var temple=function(){var a={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,statements:5,statement:6,LITERAL:7,LBRACE:8,RBRACE:9,operator:10,"variable-list":11,OPERATOR:12,variable:13,",":14,VARIABLE:15,modifier:16,"}":17,"*":18,PREFIX:19,$accept:0,$end:1},terminals_:{2:"error",7:"LITERAL",8:"LBRACE",9:"RBRACE",12:"OPERATOR",14:",",15:"VARIABLE",17:"}",18:"*",19:"PREFIX"},productions_:[0,[3,1],[4,0],[4,1],[5,1],[5,2],[6,1],[6,2],[6,4],[10,0],[10,1],[11,1],[11,3],[13,2],[13,3],[16,0],[16,1],[16,1]],performAction:function(b,c,d,e,f,g,h){var i=g.length-1;switch(f){case 1:return this.$=g[i];case 2:this.$=[];break;case 3:this.$=g[i];break;case 4:this.$=[g[i]];break;case 5:g[i-1].push(g[i]),this.$=g[i-1];break;case 6:this.$=new e.LiteralNode(g[i]);break;case 7:this.$=new e.ExpressionNode([]);break;case 8:this.$=new e.ExpressionNode(g[i-1],g[i-2]);break;case 10:this.$=g[i];break;case 11:this.$=[g[i]];break;case 12:g[i-2].push(g[i]),this.$=g[i-2];break;case 13:this.$=new e.VariableNode(g[i-1],g[i]);break;case 16:this.$=g[i];break;case 17:this.$=g[i]}},table:[{1:[2,2],3:1,4:2,5:3,6:4,7:[1,5],8:[1,6]},{1:[3]},{1:[2,1]},{1:[2,3],6:7,7:[1,5],8:[1,6]},{1:[2,4],7:[2,4],8:[2,4]},{1:[2,6],7:[2,6],8:[2,6]},{9:[1,8],10:9,12:[1,10],15:[2,9]},{1:[2,5],7:[2,5],8:[2,5]},{1:[2,7],7:[2,7],8:[2,7]},{11:11,13:12,15:[1,13]},{15:[2,10]},{9:[1,14],14:[1,15]},{9:[2,11],14:[2,11]},{2:[1,17],9:[2,15],14:[2,15],16:16,18:[1,18],19:[1,19]},{1:[2,8],7:[2,8],8:[2,8]},{13:20,15:[1,13]},{9:[2,13],14:[2,13]},{17:[1,21]},{9:[2,16],14:[2,16]},{9:[2,17],14:[2,17]},{9:[2,12],14:[2,12]},{9:[2,14],14:[2,14]}],defaultActions:{2:[2,1],10:[2,10]},parseError:function(b,c){throw new Error(b)},parse:function(b){function o(a){d.length=d.length-2*a,e.length=e.length-a,f.length=f.length-a}function p(){var a;return a=c.lexer.lex()||1,typeof a!="number"&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0,l=2,m=1;this.lexer.setInput(b),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var n=this.lexer.yylloc;f.push(n),typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var q,r,s,t,u,v,w={},x,y,z,A;for(;;){s=d[d.length-1],this.defaultActions[s]?t=this.defaultActions[s]:(q==null&&(q=p()),t=g[s]&&g[s][q]);if(typeof t=="undefined"||!t.length||!t[0]){if(!k){A=[];for(x in g[s])this.terminals_[x]&&x>2&&A.push("'"+this.terminals_[x]+"'");var B="";this.lexer.showPosition?B="Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+A.join(", ")+", got '"+this.terminals_[q]+"'":B="Parse error on line "+(i+1)+": Unexpected "+(q==1?"end of input":"'"+(this.terminals_[q]||q)+"'"),this.parseError(B,{text:this.lexer.match,token:this.terminals_[q]||q,line:this.lexer.yylineno,loc:n,expected:A})}if(k==3){if(q==m)throw new Error(B||"Parsing halted.");j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,n=this.lexer.yylloc,q=p()}for(;;){if(l.toString()in g[s])break;if(s==0)throw new Error(B||"Parsing halted.");o(1),s=d[d.length-1]}r=q,q=l,s=d[d.length-1],t=g[s]&&g[s][l],k=3}if(t[0]instanceof Array&&t.length>1)throw new Error("Parse Error: multiple actions possible at state: "+s+", token: "+q);switch(t[0]){case 1:d.push(q),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(t[1]),q=null,r?(q=r,r=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,n=this.lexer.yylloc,k>0&&k--);break;case 2:y=this.productions_[t[1]][1],w.$=e[e.length-y],w._$={first_line:f[f.length-(y||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(y||1)].first_column,last_column:f[f.length-1].last_column},v=this.performAction.call(w,h,j,i,this.yy,t[1],e,f);if(typeof v!="undefined")return v;y&&(d=d.slice(0,-1*y*2),e=e.slice(0,-1*y),f=f.slice(0,-1*y)),d.push(this.productions_[t[1]][0]),e.push(w.$),f.push(w._$),z=g[d[d.length-2]][d[d.length-1]],d.push(z);break;case 3:return!0}}return!0}},b=function(){var a={EOF:1,parseError:function(b,c){if(!this.yy.parseError)throw new Error(b);this.yy.parseError(b,c)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.match+=a,this.matched+=a;var b=a.match(/\n/);return b&&this.yylineno++,this._input=this._input.slice(1),a},unput:function(a){return this._input=a+this._input,this},more:function(){return this._more=!0,this},less:function(a){this._input=this.match.slice(a)+this._input},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=(new Array(a.length+1)).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d,e,f;this._more||(this.yytext="",this.match="");var g=this._currentRules();for(var h=0;h<g.length;h++){c=this._input.match(this.rules[g[h]]);if(c&&(!b||c[0].length>b[0].length)){b=c,d=h;if(!this.options.flex)break}}if(b){f=b[0].match(/\n.*/g),f&&(this.yylineno+=f.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:f?f[f.length-1].length-1:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,g[d],this.conditionStack[this.conditionStack.length-1]);if(a)return a;return}if(this._input==="")return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var b=this.next();return typeof b!="undefined"?b:this.lex()},begin:function(b){this.conditionStack.push(b)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(b){this.begin(b)}};return a.options={},a.performAction=function(b,c,d,e){var f=e;switch(d){case 0:return this.begin("expression"),8;case 1:return this.popState(),9;case 2:return 15;case 3:return 12;case 4:return 19;case 5:return 18;case 6:return 14;case 7:return 7}},a.rules=[/^\{/,/^\}/,/^[a-zA-Z0-9_]+/,/^[\?\/\.;&#+]/,/^:\d+/,/^\*/,/^,/,/^[^{]+/],a.conditions={expression:{rules:[0,1,2,3,4,5,6,7],inclusive:!0},INITIAL:{rules:[0,1,7],inclusive:!0}},a}();return a.lexer=b,a}();Temple.Expression=Expression,Expression.prototype={expand:function(a){var b=this._filterVars(a),c=Temple.Array.map(b,this._expand,this).join(this._op.sep);return c?this._op.first+c:this._op.first&&!this._op.named&&b.length?this._op.first:""},_encodeArray:function(a,b){return Temple.Array.map(a,function(a){return a=this._encode(a),this._op.named?[b,a]:a},this)},_encodeObject:function(a,b){var c=[];return Temple.Object.each(a,function(a,b){Temple.Array.isArray(a)?c=c.concat(this._encodeArray(a,b)):c.push([Temple.Encoder.varname(b),this._encode(a)])},this),c},_expand:function(a){var b;if(a.explode)return this._explode(a.name,a.value);switch(typeof a.value){case"boolean":case"number":case"string":b=""+a.value,a.prefix&&(b=b.substring(0,parseInt(a.prefix,10))),b=this._encode(b);break;default:b=this._stringify(a.value)}return this._op.named?a.name+(b?"="+b:this._op.ifemp):b},_explode:function(a,b){if("string"==typeof b)throw new Error("Invalid explode modifier for string value: "+b);var c=Array.isArray(b)?this._encodeArray(b,a):this._encodeObject(b,a);return Temple.Array.map(c,function(a){return Array.isArray(a)?a.join("="):a},this).join(this._op.sep)},_filterVars:function(a){var b;return Temple.Array.filter(this._params,function(c){return c.value=b=a[c.name],b===undefined||b===null?!1:Array.isArray(b)?b.length>0:typeof b=="object"?Temple.Object.some(b,function(a,b){return a!==undefined&&a!==null}):!0})},_stringify:function(a){var b=[];return typeof a=="object"?Temple.Array.isArray(a)?Temple.Array.map(a,this._encode).join(","):(Temple.Object.each(a,function(a,c){b.push(Temple.Array.map([c,a],this._encode).join(","))},this),b.join(",")):this._encode(a)}},Temple.AST={ExpressionNode:function(a,b){this.type="expression",this.op=b,this.params=a},LiteralNode:function(a){this.type="literal",this.value=a},VariableNode:function(a,b){this.type="variable",this.name=a,"*"===b?this.explode=!0:this.prefix=b&&b.slice(1)}},Temple.Parser=temple,Temple.Parser.yy=Temple.AST,Temple.compile=function(a){var b=Temple.Parser.parse(a);return function(a){var c="";return Temple.Array.each(b,function(b){switch(b.type){case"literal":c+=Temple.Encoder.literal(b.value);break;case"expression":c+=(new Temple.Expression(b)).expand(a)}}),c}},Temple.expand=function(a,b){return Temple.compile(a)(b)};